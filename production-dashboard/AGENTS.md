# AGENTS.md — i-SENS 바이오센서 스트립 생산 대시보드 v3

> Codex / Claude Code 에이전트가 이 프로젝트를 이해하고 작업하기 위한 마스터 지침서.
> 이 파일은 **프로젝트의 뇌**다. 모든 세션 시작 시 반드시 읽을 것.

---

## 🚨 절대 규칙 (모든 에이전트 필수 준수)

1. **파일당 1,500줄 기본 제한** — 넘기면 모듈로 분리. 단, 분리 시 품질 저하가 명확한 경우 사용자 승인 하에 초과 허용
2. **UI 텍스트 한국어 필수** — 변수명은 영어, 주석은 한국어 허용
3. **X/Y 용어 금지** — 반드시 "←좌 / 우→", "↑상 / 하↓" 같은 직관적 한국어 표현
4. **부호 방향 규칙**: 양수(+) = 우측/위, 음수(-) = 좌측/아래 — 틀리면 보정 방향 반대! `docs/project-reference.md` 섹션 5 참조
5. **CSV 파싱**: UTF-16 LE BOM + 탭 구분자 + `:BEGIN`~`:END` 블록
6. **공정별 독립 화면** — 작업자는 자기 공정 탭만 본다
7. **데이터 영속성** — 탭 이동해도 데이터 절대 사라지지 않게 상태관리
8. **think 레벨 사용**: 단순작업=기본, 판정로직=think hard, 아키텍처=ultrathink
9. **Q값 최적화 엔진 불필요** — 설비가 의도대로 움직이므로 Q-sweep 최적화 제외
10. **부호/방향 정본**: `docs/project-reference.md`가 유일한 정본. 충돌 시 이 문서 우선

---

## 1. 프로젝트 개요

- **목적**: 바이오센서 스트립 제조 라인의 품질관리(QC) + 생산 모니터링 + AI 코멘트 대시보드
- **사용자**: 현장 작업자(공정별 다수), 현장 관리자(1~2명)
- **핵심 가치**: 데이터 → 품질 판단 → AI 코멘트 → 조정 안내 → 공정 연동 → 보고서
- **기존 문제**: Rev8 현장 피드백 "좋긴 한데 더 발전했으면" → AI 코멘트 고도화, 공정 연동

---

## 2. 제품 구조

### 시트 구조
- **12 Row × 50 Column** = 1시트 600개 스트립
- **대면형(Counter-electrode)**: 하판 + 상판을 조립

### 하판 (Bottom Plate)
- 카본(Carbon) → 절연(Insulation) → 실버(Silver) 순서로 **3도 인쇄**
- 분주(Dispensing) 공정에서 시약 도포

### 상판 (Top Plate)
- 카본 → 실버 순서로 **2도 인쇄**
- 트레이 1번/2번 별도 보정 필요
- ⚠️ 상판은 하판과 로직이 동일함 (같은 파서/차트 재사용 가능)

### 조립
- 하판과 상판 사이에 **양면테이프** (정렬 기준)
- **타발홀**에 핀 삽입 → 정렬 기준

---

## 3. 공정 탭 구성 (7개 + 관리 3개)

| 탭 | 공정 | 사용자 | 데이터 |
|----|------|--------|--------|
| ① | 하판 프린팅 | 프린팅 작업자 | 프린팅CSV, 전극면적CSV |
| ② | 상판 프린팅 | 프린팅 작업자 | 프린팅CSV (상판용) |
| ③ | 분주 | 분주 작업자 | 분주형상CSV |
| ④ | 로우슬리팅 | 슬리팅 작업자 | 로우슬리터CSV |
| ⑤ | 50T 타발 | 타발 작업자 | 샘플검사CSV (타발홀 섹션) |
| ⑥ | 개별 슬리팅 | 슬리팅 작업자 | (확장 준비) |
| ⑦ | 조립/검사 | 조립 작업자 | 샘플검사CSV (양면 섹션) |
| ⑧ | 관리자 종합 | 관리자 | 전체 + 마진 공유 + 공정 연동 |
| ⑨ | 트렌드 | 관리자 | SET 시계열 + 이상감지 |
| ⑩ | 보고서 | 관리자 | PDF 원클릭 |

⚠️ **작업자는 자기 공정 탭만 본다. 다른 공정 데이터를 섞지 말 것.**
⚠️ **단, 공정 간 보정 요청은 알림으로 전달됨 (섹션 5 참조)**

---

## 4. 현장 워크플로우

```
1단계: 셋업 확인 → 프린팅 위치, 로우슬리터 상태
2단계: 시험 조립 → 1장 조립 후 12Row 치우침 확인, 보정값 결정
3단계: 개선 검증 → Before vs After 비교
4단계: 생산 모니터링 → 주기적 샘플링, 이상 감지
```

---

## 5. 공정 간 연동 시뮬레이션 ⚠️ 핵심

### 연동 대상 공정
프린팅 ↔ 로우슬리터 ↔ 조립 (3개 공정이 마진을 공유)

### 핵심 시나리오
```
시나리오: 조립에서 원자재 이슈로 마진 부족
① 조립 담당 → "프린팅 좌측 0.03mm 보정 필요" 요청
② 프린팅 담당 → 보정값 수신, 자기 공정 마진 확인
   - 설비에 기존 1차 입력값 있음 → 2차 보정값 계산
   - 내 공정 마진도 유지하면서 최적점 찾기
③ 관리자 → 프린팅 보정 후 로우슬리터 마진 변화도 확인
④ 전체 공정 마진 상태 리뷰
```

### 보정값 전달 흐름
```
조립 마진 부족 → 관리자 판단 → 프린팅에 보정 요청
프린팅: 1차 보정값(기존) + 2차 보정값(추가) = 최종 입력값
결과: Before/After 비교 + 전 공정 마진 변화 확인
```

### 학습/피드백 루프
"이 편차에서 이 보정값을 추천했고, 실제 적용 후 결과가 이랬다"를 기록.
다음에 같은 패턴 → 추천 정확도 개선.

---

## 6. 부호 방향 규칙 ⚠️ 치명적

**정본: `docs/project-reference.md` 섹션 5**

| 축 | 양수(+) | 음수(-) | UI 표현 |
|----|---------|---------|---------|
| 좌우 | 우측으로 치우침 | 좌측으로 치우침 | ←좌 / 우→ |
| 상하 — 프린팅 | **위(상)로 치우침** | **아래(하)로 치우침** | ↑상 / 하↓ |
| 상하 — 로우슬리터 타발폭 | **위로 쏠림** | **아래로 쏠림** | ↑상 / 하↓ |

> 프린팅 상하 부호: 일반 좌표계와 동일 (양수=위, 음수=아래)

**보정 방향 = 편차 부호의 반대**

⚠️ **Rev.8에서 방향이 반대로 나온 사례가 있었음. project-reference.md를 반드시 따를 것.**

---

## 7. AI 코멘트 시스템 ⚠️ Rev.8 대비 대폭 강화

### 코멘트 4단계

| 레벨 | 유형 | 예시 |
|------|------|------|
| 1 | 단일 공정 | "포인트3 절연 상하 마진 12%로 NG 임박, 하방 0.03mm 보정 권장" |
| 2 | 공정 연동 | "조립 양면테이프 편심 증가 → 프린팅에서 우측 0.02mm 선제 보정 권장" |
| 3 | 트렌드 기반 | "SET 295부터 카본 좌우가 계속 우측으로 밀림, 스텐실 점검 필요" |
| 4 | 학습 기반 | "이전 동일 패턴에서 0.05mm 보정 시 과보정, 0.03mm로 줄여 추천" |

### 코멘트 위치
- 각 공정 페이지 상단에 AI 코멘트 패널
- 관리자 종합 페이지에 전체 공정 코멘트 요약
- 긴급(NG 임박) 시 알림 배지

---

## 8. 데이터 아키텍처

### 3-레이어 데이터 구조

```
data/
├── raw/                          ← ① 원본 CSV (설비 출력 그대로)
│   ├── printing/                 ← 공정별 폴더
│   │   └── 2026-02-13/          ← 날짜별 폴더
│   │       ├── 250122_프린팅A_가속3차_SET_3.csv
│   │       └── ...
│   ├── electrode/
│   ├── dispensing/
│   ├── row-slitter/
│   └── assembly/
│
├── processed/                    ← ② 가공 데이터 (파싱 결과 JSON)
│   ├── printing/
│   │   └── 2026-02-13/
│   │       └── SET_298.json
│   ├── trend/                    ← 트렌드 집계
│   └── reports/                  ← 생성된 PDF
│
└── learning/                     ← ③ 학습/피드백 데이터
    ├── adjustment_log.json       ← 보정 추천 vs 실제 결과
    ├── pattern_library.json      ← 반복 패턴 라이브러리
    └── correction_factors.json   ← 보정 계수 (추천 정확도 개선)
```

### 파일명 규칙

**원본 CSV (설비 출력):**
`{날짜6자리}_{공정+라인}_{Lot명}_{상태}_{시트순번}_{메모(선택)}.csv`

- 날짜: `YYMMDD` 6자리 (예: `250122`)
- 공정+라인: `프린팅A`, `분주A`, `로우슬리터A`, `전극면적A`, `샘플검사A` 등
- Lot명: 생산 로트 식별자 (예: `가속3차`, `LOT001`)
- 상태: `SET`(셋팅) | `TEST`(테스트) | `PRD`(생산)
- 시트순번: 해당 상태에서 몇 번째 시트인지 나타내는 숫자
- 메모: 선택사항. 이슈/조건변경 기록 (예: `노즐교체후`, `스텐실교체후`)

예시:
- `250122_프린팅A_가속3차_SET_3.csv`
- `250122_프린팅A_가속3차_PRD_15.csv`
- `250122_분주A_가속3차_TEST_1_노즐교체후.csv`
- `250122_로우슬리터A_LOT001_PRD_7.csv`
- `250122_샘플검사A_가속3차_SET_2_조건변경.csv`

파싱 규칙:
- 구분자: `_` (언더스코어)
- `split('_')` 기준 최소 5개 필드 필요, 6번째부터는 메모로 결합
- 상태 필드는 `SET/TEST/PRD` 3종만 허용

**가공 데이터 (시스템 생성):**
`{공정}/{날짜}/SET_{번호}.json`

**학습 데이터 (시스템 자동 누적):**
- `adjustment_log.json` — [{timestamp, process, deviation, recommended, actual_result, accuracy}]
- `pattern_library.json` — [{pattern_id, conditions, typical_deviation, best_correction}]
- `correction_factors.json` — [{process, direction, factor, confidence, sample_count}]

### 데이터 규모
- 일 15~30개 CSV × 365일 = **연 5,000~10,000개 원본 파일**
- 가공 JSON + 트렌드 집계 ≒ 원본의 1.5배
- 학습 데이터 = 점진적 누적

### CSV 파일 5종 요약

| 파일 | 줄수 | 식별키워드 | 허용범위 |
|------|------|-----------|---------|
| 프린팅 | 47줄 | 타발기준_카본, 거리 타발 | CHECK ±0.12 / NG ±0.15mm |
| 전극면적 | 302줄 | 전극폭, 전극길이 | 기준값 없음 |
| 분주형상 | 542줄 | 분주면적, 분주간격 | 기준값 없음 |
| 로우슬리터 | 20줄 | 전체폭, 타발폭 | ±0.1000mm |
| 샘플검사 | 206줄 | 타발홀, 양면, 양면상하 | NG ±0.15mm |

상세: `.agents/skills/csv-parser/SKILL.md`, `docs/project-reference.md` 섹션 6

---

## 9. 기술 스택

```
프론트엔드: React + Vite + Tailwind CSS
차트: Recharts — 일관된 라이브러리 하나만 사용
상태관리: Zustand — 탭 이동 시 데이터 유지
테이블: AG Grid (또는 TanStack Table)
보고서: jsPDF + html2canvas
백엔드: Python FastAPI (CSV 파싱 + 폴더 감시)
```

### 코드 규칙
- 변수명: 영어 (camelCase), 주석: 한국어
- **파일당 1,500줄 기본 제한** — 사용자 승인 시 초과 허용
- 컴포넌트: 기능 단위 분리, 재사용 가능하게

---

## 10. 디자인 규칙

### i-SENS CI 색상
| 이름 | 코드 | 용도 |
|------|------|------|
| i-SENS Blue | `#171C8F` | Primary |
| Soulstone Blue | `#2D68C4` | Secondary |
| Dark Pastel Blue | `#88A7E1` | Accent |
| Brilliant White | `#EDF1FE` | Background |

### 판정 색상
| 상태 | 색상 | 코드 |
|------|------|------|
| OK | 파랑 | `#2D68C4` |
| CHECK | 노랑 | `#F59E0B` |
| NG | 빨강 | `#EF4444` |

### 현장 UX
- **모니터**: 최소 27인치 (QHD 2560×1440 이상 기준)
- 터치/클릭 영역: **최소 44px**
- 글자: 본문 16px+, 라벨 13px+, 차트 수치 14px+
- 표 텍스트: **중앙 정렬 기본**
- 열 제목: **말줄임(...) 금지, 줄바꿈 허용**
- 막대바: 수치 텍스트를 **바 내부 또는 바로 옆에 표시**
- 모바일 불필요 (데스크톱 전용, 2560×1440 기준 설계)

### UI 설계 가이드 (현장 에이전트 합의 반영)

#### 1) 프린팅/조립 그래프의 방향성 시각화 규칙
- **부호 방향은 항상 `docs/project-reference.md` 섹션 5를 따른다**: 양수(+)는 우측/위, 음수(-)는 좌측/아래.
- 모든 축/범례/툴팁/카드에 **X/Y 표기 금지**. 반드시 `←좌 / 우→`, `↑상 / 하↓`를 사용한다.
- 0 기준선(중앙선)을 두껍게 표시하고, 좌/하 영역은 음수 컬러 톤, 우/상 영역은 양수 컬러 톤으로 시각 분리한다.
- 프린팅·조립 공정의 핵심 편차 차트에는 **방향 아이콘(←, →, ↑, ↓) + 부호(+/-) + mm 수치**를 동시에 표시한다.
- 임계값선은 최소 2단으로 고정 표기한다: CHECK(±0.12), NG(±0.15). 작업자가 현재 편차의 위험 구간을 즉시 읽을 수 있어야 한다.

#### 2) "어느 방향으로 얼마나 보정"을 즉시 읽는 차트 구성 원칙
- 차트 제목 자체를 행동 문구로 작성한다. 예: `좌우 편차 및 권장 보정(←좌 / 우→)`.
- 차트 내 주요 지점(최대 편차 포인트, NG 근접 포인트)에 **권장 보정 배지**를 바로 붙인다.
  - 표기 형식: `현재 +0.03mm(우→) → 권장 -0.03mm(←좌)`
- 편차와 보정을 분리하지 말고 한 시야 안에 배치한다.
  - 예: 막대(현재 편차) + 오버레이 마커(권장 보정) 또는 Before/After 페어 바.
- 툴팁 1순위 정보는 측정값이 아니라 **조치값**으로 한다.
  - 1줄: 권장 보정 방향/크기
  - 2줄: 현재 편차와 판정(OK/CHECK/NG)
- 조립 공정은 12 Row 치우침을 확인하는 작업 특성을 반영해, Row별 편차에서 **가장 먼저 보정할 우선순위 Row**를 상단 고정 카드로 노출한다.

#### 3) 공정 에이전트 관점 종합 UI 레이아웃 권장
- **작업자 관점(worker-persona)**: "내 공정에서 바로 조치"가 핵심이므로 한 화면을 `상단 요약(현재 상태/권장 보정) → 중앙 차트(방향+크기) → 하단 근거 테이블` 3단 구조로 고정한다.
- **관리자 관점(manager-persona)**: 공정 연동 판단이 핵심이므로 관리자 화면은 `보정 요청-수신-적용-결과` 흐름을 타임라인/스텝 카드로 표현하고, 프린팅↔로우슬리터↔조립 영향도를 같은 축척으로 병렬 비교한다.
- **차트 에이전트(chart-viz)** 권고를 반영해 Recharts 단일 라이브러리 기준으로 막대/라인/히트맵을 혼용하되, 색상과 방향 표기 규칙은 공정 전체에서 동일해야 한다.
- **품질 로직(quality-logic)** 기준을 반영해 모든 레이아웃에서 `현재 편차`와 `보정값(correction = -deviation)`을 쌍으로 노출한다.
- **대시보드 UI/데이터 흐름 관점(dashboard-ui/data-flow/trend-analysis)**을 반영해 탭 이동 후에도 동일 맥락을 유지할 수 있도록 상태를 보존하고, 추세 경고(연속 CHECK/연속 NG)는 작업자 화면에도 요약 배지로 전달한다.

> 결론: 프린팅/조립 UI의 최우선 목표는 "부호 해석"이 아니라 "즉시 보정 행동"이다. 따라서 모든 시각 요소는 방향(어디로)과 크기(얼마나)를 한 번에 읽히게 설계한다.

---

## 11. 에이전트 팀 구성 (6명)

### 개발팀 (4명)

| 역할 | 모델 | 담당 | 담당 폴더 |
|------|------|------|-----------|
| 리더 | GPT-5.3-Codex | 아키텍처, 코드리뷰, 통합, 공정간 조율 | 전체 (리뷰 전용) |
| 백엔드 | GPT-5.2-Codex | 파싱, API, 폴더감시, 학습데이터 | `src/backend/` |
| 프론트엔드 | GPT-5.2-Codex | UI, 상태관리, 페이지 | `src/frontend/src/pages/`, `store/`, `hooks/` |
| 시각화 | GPT-5.3-Codex | 차트, AI코멘트, 보고서, PDF | `src/frontend/src/components/charts/`, `utils/` |

### 시뮬레이션팀 (2명)

| 역할 | 모델 | 담당 |
|------|------|------|
| 작업자 시뮬 | GPT-5.3-Codex | 7개 공정 작업자 관점 UX 테스트 |
| 관리자 시뮬 | GPT-5.3-Codex | 전체 흐름, 공정간 마진 연동 시나리오 |

### 상호작용 흐름

```
[빌드] 리더 → 개발팀 분배 → 결과 취합 + 리뷰

[시뮬] 작업자/관리자 시뮬 → 피드백 → 리더 정리 → 개발팀 수정

[시각 개선] Codex=v1 구현, Teams=피드백 루프로 v2, v3 반복
```

⚠️ **팀원 간 파일 충돌 금지 — 각 팀원이 담당 폴더만 편집**

---

## 12. 현장 피드백 (Rev.8 → v3 개선)

| # | 문제 | 해결 |
|---|------|------|
| 1 | 공정이 한 화면에 섞임 | 공정별 독립 탭 |
| 2 | 일부 공정 누락 | 전체 공정 탭 |
| 3 | 가독성 나쁨 | 중앙정렬, 27인치 QHD 최적화 |
| 4 | 수동 데이터 로딩 | 폴더 감시 자동 로딩 |
| 5 | 탭 이동 시 데이터 소실 | Zustand 상태관리 |
| 6 | 트렌드 없음 | SET 시계열 + 이상감지 |
| 7 | X/Y 이해 어려움 | 한국어 + 화살표 |
| 8 | 보고서 없음 | PDF 원클릭 |
| 9 | AI 코멘트 단순 | 4단계 코멘트 시스템 |
| 10 | 공정 연동 없음 | 마진 공유 + 보정값 전달 |
| 11 | 방향 반대 사례 | project-reference.md 정본 |

---

## 13. 파일 구조

```
production-dashboard/
├── AGENTS.md
├── README.md
├── .agents/skills/                    (9개 스킬)
│   ├── csv-parser/SKILL.md
│   ├── dashboard-ui/SKILL.md
│   ├── chart-viz/SKILL.md
│   ├── quality-logic/SKILL.md
│   ├── report-export/SKILL.md
│   ├── data-flow/SKILL.md
│   ├── trend-analysis/SKILL.md
│   ├── worker-persona/SKILL.md       ← NEW
│   └── manager-persona/SKILL.md      ← NEW
├── docs/
│   ├── project-reference.md           ← 부호 방향 정본
│   ├── field-feedback.md
│   └── execution-plan.md
├── data/
│   ├── samples/                        ← CSV 샘플 5개
│   ├── raw/{공정}/{날짜}/             ← 원본 CSV
│   ├── processed/{공정}/{날짜}/       ← 가공 JSON
│   └── learning/                       ← 학습 데이터
├── assets/drawings/
└── src/
    ├── frontend/src/
    │   ├── components/{charts,layout,shared,ai-comment}/
    │   ├── pages/
    │   ├── store/
    │   ├── hooks/
    │   └── utils/
    └── backend/
        ├── parsers/
        ├── watchers/
        ├── ai_comment/
        ├── learning/
        └── main.py
```

---

## 14. 용어 사전

| 한국어 | 영어 | UI 표시 |
|--------|------|---------|
| 원단 | Fabric | 원단 |
| 스텐실 | Stencil | 스텐실 |
| 카본 | Carbon | 카본 |
| 절연 | Insulation | 절연 |
| 분주 | Dispensing | 분주 |
| 워킹전극 | Working Electrode | 전극 |
| 타발홀 | Die-cut Hole | 타발홀 |
| 양면 | Double-sided Tape | 양면테이프 |
| 로우슬리팅 | Row Slitting | 로우슬리팅 |
| 공정마진 | Process Margin | 마진 |
| 편심 | Eccentricity | 편심 |
| 좌우 치우침 | Left-Right deviation | ←좌 / 우→ |
| 상하 치우침 | Up-Down deviation | ↑상 / 하↓ |
