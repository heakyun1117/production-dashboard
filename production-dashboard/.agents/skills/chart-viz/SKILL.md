---
name: chart-viz
description: >
  대시보드 시각화 컴포넌트 스킬. InlineDeviationBar, BiasCompass, Before/After 차트,
  다크 테마 규칙에 사용. 모든 차트/바/나침반 생성 시 활성화.
prerequisite-skills:
  - slug: dashboard-ui
    reason: "다크 테마 팔레트와 스타일 규칙 필요"
---
# chart-viz SKILL

## 목적
공정 데이터 특성에 맞는 라이브러리를 선택해 가독성과 판단 속도를 동시에 확보한다.

## 라이브러리 선택 정책
차트 에이전트는 작업에 가장 적합한 라이브러리를 자율 선택한다.

### 사용 가능 라이브러리
| 라이브러리 | 적합한 용도 | 비고 |
|-----------|-----------|------|
| Recharts | 막대, 라인, 산점도, 기본 차트 | 기본 선택, React 친화적 |
| D3.js | 히트맵, 커스텀 차트, 복잡한 인터랙션 | 자유도 최고 |
| SVG 직접 렌더링 | 테이블 내 미니차트, 인라인바 | 경량, 의존성 없음 |
| Chart.js | 간단한 캔버스 차트 | 성능 우선 시 |

### 선택 규칙
1. **단순 차트** (막대, 라인, 파이) → Recharts 우선
2. **복잡한 시각화** (히트맵, 트리맵, 커스텀) → D3.js 또는 SVG
3. **인라인 미니차트** (테이블 셀 안) → SVG 직접 렌더링
4. **선택 근거**: 코드 주석에 왜 이 라이브러리를 선택했는지 한 줄 기록
5. **혼용 가능**: 한 페이지에서 여러 라이브러리 혼용 허용

### 품질 게이트 (자동 적용)
- 어떤 라이브러리를 쓰든 **작업자 에이전트 가독성 15점 중 12점 이상** 필수
- 어떤 라이브러리를 쓰든 **관리자 에이전트 시각화 품질 15점 중 12점 이상** 필수
- 미달 시 라이브러리 변경 또는 디자인 수정 후 재검증

## 기본 규칙
- 상태 색상 매핑:
  - OK `#2D68C4`
  - CHECK `#F59E0B`
  - NG `#EF4444`

## 차트 유형 가이드
1. 막대차트: 공정/포인트별 편차 비교
2. 산점도: 분포/이상치 확인
3. 라인차트: SET 추세 분석
4. 히트맵: Row/Column 편차 밀집 확인

## 부호 방향 반영
- 양수(+): 우측/위
- 음수(-): 좌측/아래
- 축 라벨, 범례, 툴팁에 X/Y 용어 금지

## UI 문구 예시
- `좌우 편차(←좌 / 우→)`
- `상하 편차(↑상 / 하↓)`

## 체크리스트
- 임계값선(±0.12, ±0.15) 표시 여부
- 막대 내부/옆 수치 라벨 표시 여부
- 모바일이 아닌 데스크톱 QHD 가독성 확인

## 트렌드 차트 요구사항 (향후 트렌드 탭용)

### 필터링 지원
차트는 다음 필터 조합을 지원해야 한다:
- 기간: 일/주/월/커스텀 범위
- 라인: A/B/전체
- 공정: 하판/상판/로우슬리팅/분주/수동조립/전체
- 설비: (수동조립 시) #1~#4
- 작업자: (수동조립 시) 작업자ID별

### 필터 변경 시 차트 동작
- 필터 변경 → 차트 즉시 업데이트 (리렌더링)
- 데이터 없는 구간 → 빈 영역 표시 (선 끊김, 회색 배경)
- 로딩 중 → 스켈레톤 또는 스피너

### 대량 데이터 처리
- 100 SET 이하: 전체 포인트 표시
- 100~500 SET: 이동평균 오버레이 + 원본 포인트 축소
- 500 SET 이상: 집계 데이터(일별/주별 평균) 사용, 원본은 줌 시 로드

### 정렬 옵션
- 시간순 (기본)
- 편차 크기순 (최대 편차 우선)
- 마진율순 (위험 구간 우선)

### 축 기반 자유 조합 설계
조합을 미리 열거하지 않는다. 사용자가 X축/Y축/그룹을 직접 선택하여 자유롭게 조합한다.

**X축 후보:**
- 일자 (일별/주별/월별)
- SET 번호
- 로트 번호
- Row 번호

**Y축 후보:**
- 편차값 (mm)
- 마진율 (%)
- 불량률 (NG/CHECK 비율)
- 보정값 (적용된 보정 이력)

**그룹 (색상/선 구분):**
- 라인 (A / B)
- 로트
- 설비 (#1~#4 등)
- 작업자 (작업자ID)
- 공정 (하판/상판/로우슬리팅/분주/수동조립)
- 트레이 (상판 한정: 트레이1/2)

**동작 원리:**
- 사용자가 X축=일자, Y축=편차값, 그룹=라인 선택 → A/B 라인 일별 편차 추이 비교 차트
- 사용자가 X축=로트, Y축=불량률, 그룹=설비 선택 → 설비별 로트 불량률 비교 차트
- 축/그룹 변경 시 차트 즉시 리렌더링
- 조합이 의미 없는 경우 (예: X축=Row, 그룹=로트) → 비활성 또는 안내 메시지

## 인라인 시각화 컴포넌트 규격

### InlineDeviationBar (인라인 편차 바)
- 전체 너비: 144px (half=72px, 좌우 대칭)
- 스케일: ±0.2mm 범위를 144px에 매핑
- 중앙선: 1px 회색
- CHECK 기준선: ±0.12 위치에 노란 점선
- NG 기준선: ±0.15 위치에 빨간 점선
- 바 높이: 10px, 둥근 모서리
- 바 색상: 판정 색상(OK=파랑, CHECK=노랑, NG=빨강)
- 오른쪽에 수치 텍스트 (±0.000mm 형식)

### BiasCompass (치우침 나침반)
- 크기: 88×88px SVG
- 배경원: 연한 회색 (다크테마 시 palette.card)
- 스케일: ±0.2mm를 원 내부에 매핑
- 포인트: 판정 색상으로 표시
- 방향 라벨: ←좌, 우→, ↑상, 하↓

### 다크 테마 차트 규칙
- 차트 배경: 투명
- 그리드선: palette.border (#334155)
- 축 텍스트: palette.textDim (#94A3B8)
- 기준선(CHECK/NG): 동일 색상, 점선
- 범례: palette.text (#F1F5F9)

## 현장 에이전트 재평가 기준 (작업자 + 관리자)

### 평가 대상
1. InlineDeviationBar (테이블 내 편차 바)
2. BiasCompass (나침반형 편차 방향 표시)
3. Before/After 시뮬레이션 차트
4. 마진율 색상 표시
5. 요약카드 레이아웃
6. AI 코멘트 패널

### 작업자 에이전트 평가 기준 (각 항목 /15)
| 항목 | 기준 |
|------|------|
| 3초 판독 | 차트를 3초 내에 읽을 수 있는가 |
| 값 정확성 | 수치가 정확하게 보이는가 |
| 방향 직관성 | ←좌/우→, ↑상/하↓ 일관적인가 |
| 색상 구분 | OK/CHECK/NG 색상이 즉시 구분되는가 |
| 조작 용이성 | 슬라이더/입력 조작이 쉬운가 |

### 관리자 에이전트 평가 기준 (각 항목 /15)
| 항목 | 기준 |
|------|------|
| 전체 파악 | 한 화면에서 상태 파악 가능한가 |
| 비교 용이 | A/B 라인, 트레이, 공정 간 비교 가능한가 |
| 추세 인지 | 악화/개선 추세가 보이는가 |
| 정보 밀도 | 너무 빽빽하거나 너무 비어있지 않은가 |
| 의사결정 | 차트만 보고 행동을 결정할 수 있는가 |

### 판정 규칙
- 각 항목 12점 이상: PASS
- 각 항목 8~11점: 개선 권고 (코멘트에 구체적 개선안 제시)
- 각 항목 7점 이하: FAIL (반드시 수정 필요)

### 현재 구현 재평가 요약 (2026-02)

#### 작업자 에이전트 점수
| 항목 | 점수(/15) | 판정 | 코멘트 |
|------|-----------|------|--------|
| 3초 판독 | 13 | PASS | 인라인 바/색상/요약카드로 위험 행 식별이 빠름 |
| 값 정확성 | 14 | PASS | mm 단위 고정 포맷과 테이블 수치 동시 표시 |
| 방향 직관성 | 13 | PASS | 화살표 라벨 일관적, X/Y 노출 없음 |
| 색상 구분 | 14 | PASS | OK/CHECK/NG 대비가 높고 기준선도 분리됨 |
| 조작 용이성 | 12 | PASS | 수치입력+슬라이더 동시 제공, 단 모바일 고려는 제외 |
| **합계** | **66/75** | **PASS** | **게이트 충족 (항목별 12점 이상)** |

#### 관리자 에이전트 점수
| 항목 | 점수(/15) | 판정 | 코멘트 |
|------|-----------|------|--------|
| 전체 파악 | 13 | PASS | 요약카드+Worst Row+AI 코멘트로 상태 파악 가능 |
| 비교 용이 | 12 | PASS | 공정/트레이 비교는 가능하나 일부 화면은 확장 여지 있음 |
| 추세 인지 | 12 | PASS | Before/After 즉시 비교로 개선 여부 확인 가능 |
| 정보 밀도 | 13 | PASS | 테이블/카드 균형이 양호하고 과밀도 낮음 |
| 의사결정 | 12 | PASS | 권고 문구와 보정값 계산기 연계로 조치 가능 |
| **합계** | **62/75** | **PASS** | **게이트 충족 (항목별 12점 이상)** |

#### 개선 제안 (권고)
- 비교 용이성 향상: 관리자 탭에 A/B 라인 스몰멀티플(동일 축 고정) 추가
- 추세 인지 향상: 20~30 SET 이동평균선 기본 ON + 원본 ON/OFF 토글 제공
- 의사결정 향상: AI 코멘트에 "권장 조치 우선순위(즉시/금일/주간)" 배지 추가
