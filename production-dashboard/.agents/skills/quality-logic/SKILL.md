---
name: quality-logic
description: >
  품질 판정 로직 스킬. OK/CHECK/NG 판정, 보정값 계산, RowSummary 타입,
  공정간 보정값 전달 프로토콜에 사용.
---
# quality-logic SKILL

## 목적
품질 판정, 마진 계산, 보정값 추천, AI 코멘트 생성의 기준 로직을 정의한다.

## 1) 3단계 판정
- OK / CHECK / NG
- 기본 임계:
  - CHECK: |d| >= 0.12mm
  - NG: |d| >= 0.15mm

## 2) 공정별 허용범위
- 프린팅: CHECK ±0.12, NG ±0.15
- 로우슬리터: 공정 규격 우선(기본 ±0.10 참조 가능)
- 샘플검사: NG ±0.15
- 상세 값 충돌 시 project-reference 우선

## 3) 마진 계산식
```text
margin = limit - abs(deviation)
marginRate(%) = (margin / limit) * 100
```

## 4) 보정값 계산
```text
correction = -deviation * factor
```
- 기본 factor = 1.0
- 과보정 이력 있으면 factor < 1.0 적용

## 5) AI 코멘트 4레벨
1. 단일공정
2. 공정연동
3. 트렌드기반
4. 학습기반

## 6) 이상치 판별
- 단일 포인트 급변
- 연속 CHECK 누적
- 연속 NG 즉시 경보

## 7) 95점 만족도 연계

UI 구현 시 아래 6항목을 반드시 충족해야 한다:
1. 정보 접근성 (20점): 스크롤 없이 요약 + 테이블 즉시 표시
2. 방향 직관성 (15점): X/Y 용어 0건
3. 보정 안내 (20점): 모든 편차에 correctionText() 적용
4. 시각화 품질 (15점): InlineDeviationBar + BiasCompass 필수
5. 시뮬레이션 (15점): 입력 → 즉시 Before/After 비교
6. 긴급 대응 (15점): NG행 빨간 강조 + AI코멘트 최우선 안내

## 8) RowSummary 표준 타입

각 Row의 최악 편차를 기준으로 판정한다:
- worst = max(|leftRight|, |upDown|)
- worstAxis = worst가 leftRight에서 나왔으면 '좌우', upDown이면 '상하'
- status = getStatus(worst)

이 타입은 요약카드, AI코멘트, 시뮬레이션에서 공통으로 사용.

## 9) 보정값 전달 프로토콜

공정 간 보정 요청 시 아래 정보를 전달:
- 요청 공정 (from)
- 대상 공정 (to)
- 보정 방향 (좌우/상하)
- 보정 크기 (mm)
- 근거 (어떤 편차 때문인지)
- 긴급도 (일반/긴급)

## 수동조립 품질 판정

### 측정 포인트
- 좌측 타발홀 6개 + 우측 타발홀 6개 = 총 12개
- 각 타발홀의 편차값 (mm 단위)
- 조립시트 타발 편차값과 동일한 측정 포인트

### 판정 기준
- OK/CHECK/NG 기준은 프린팅과 동일 (CHECK_LIMIT ±0.12mm, NG_LIMIT ±0.15mm)
- 개별 타발홀 판정 + 설비 종합 판정

### 이중 편차 분석
| 분석 유형 | 방법 | 목적 |
|-----------|------|------|
| 설비 편차 | 동일 설비, 다른 작업자 → 설비 평균 | 설비 자체 문제 식별 |
| 작업자 편차 | 동일 작업자, 다른 설비 → 작업자 평균 | 작업자 습관 식별 |
| 좌우 치우침 | 좌측 6개 평균 vs 우측 6개 평균 | 정렬 방향 문제 식별 |

### 좌우 치우침 판정
- |좌측평균 - 우측평균| > CHECK_LIMIT × 0.5 → "좌우 정렬 확인 필요"
- 좌우 차이 방향 = 보정 반대 방향 (기존 부호 규칙 준수)


## 조립/검사 품질 판정

### 측정 섹션 (3개)
| 섹션 | 측정 대상 | 허용범위 |
|------|----------|---------|
| 타발홀 | 조립 정렬 기준점 좌우/상하 | NG ±0.15mm |
| 양면(좌우) | 양면테이프 위치 좌우 편차 | NG ±0.15mm |
| 양면(상하) | 양면테이프 위치 상하 편차 | NG ±0.15mm |

### 잔여율 판정 (Rev.8 핵심 개념)
```
이동가능(mm) = NG_LIMIT - |현재 편차|
잔여율(%) = 이동가능 / NG_LIMIT × 100
```

| 잔여율 | 의미 | 색상 | 대응 |
|--------|------|------|------|
| >50% | 여유 있음 | 녹색 | 모니터링 |
| 20~50% | 주의 필요 | 노란색 | 추세 관찰 |
| <20% | 위험 | 빨간색 | 즉시 보정 |
| 0% | NG 도달 | 빨간색 강조 | 긴급 대응 |

### 보정 방식 차이 (치명적 중요!)
| 공정 | 보정 범위 | 보정 단위 |
|------|----------|----------|
| 프린팅 | **전역** (전체 Row 동시) | Q/좌우/상하 1세트 |
| 로우슬리터 | **전역** | 전체 동시 |
| **자동조립기** | **Row별 개별** | 12개 Row × 좌우/상하 각각 |

### Row 패턴 분석
- 특정 Row만 편차 → 조립기 지그 문제 (개별 보정)
- Row 1→12 점진 증가 → 기울기 문제 (프린팅 전역 보정)
- 전체 동일 방향 → 공통 원인 (프린팅 위치 문제)
- 좌우/상하 편차 방향 일치 → 동일 원인 추정
